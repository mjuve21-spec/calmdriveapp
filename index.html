<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CalmDrive</title>
<link rel="manifest" href="./manifest.json">
<link rel="icon" sizes="32x32" href="./icon192x192.png">
<link rel="icon" sizes="192x192" href="./icon192x192.png">
<link rel="apple-touch-icon" href="./icon192x192.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="CalmDrive">
<meta name="theme-color" content="#1E3A8A">

<!-- For Android -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="application-name" content="CalmDrive">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  min-height: 100vh;
  background: linear-gradient(135deg, #0a1628, #1a2847, #2a3f6f, #3b4f8a, #1e3a8a);
  background-size: 300% 300%;
  animation: gradientShift 12s ease infinite;
  color: white;
  overflow-x: hidden;
  position: relative;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.ambient-bg {
  position: fixed;
  inset: -60%;
  background:
    radial-gradient(circle at 20% 20%, rgba(139,92,246,.7), transparent 30%),
    radial-gradient(circle at 80% 30%, rgba(236,72,153,.6), transparent 35%),
    radial-gradient(circle at 40% 70%, rgba(59,130,246,.65), transparent 32%),
    radial-gradient(circle at 75% 75%, rgba(167,139,250,.55), transparent 38%);
  filter: blur(80px);
  animation: ambientFloat 18s ease-in-out infinite;
  z-index: -1;
  will-change: transform;
}

@keyframes ambientFloat {
  0% { transform: translate(0%, 0%) scale(1); }
  25% { transform: translate(15%, -10%) scale(1.2); }
  50% { transform: translate(-10%, 15%) scale(1.1); }
  75% { transform: translate(12%, 8%) scale(1.25); }
  100% { transform: translate(0%, 0%) scale(1); }
}

header {
  text-align: center;
  padding: 48px 20px 24px;
}

.logo {
  width: 96px;
  height: 96px;
  margin: 0 auto 14px;
  display: block;
  border-radius: 24px;
  box-shadow: 0 25px 60px rgba(59,130,246,.6), 0 0 0 6px rgba(255,255,255,.08);
}

.greeting {
  font-size: 18px;
  font-weight: 600;
  opacity: .85;
  margin-bottom: 8px;
}

.greeting-edit {
  display: inline-block;
  margin-left: 8px;
  padding: 4px 10px;
  background: rgba(255,255,255,.1);
  border-radius: 12px;
  font-size: 12px;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,.2);
  transition: all .3s ease;
}

.greeting-edit:hover {
  background: rgba(255,255,255,.2);
}

h1 {
  font-size: 42px;
  font-weight: 900;
  margin-bottom: 6px;
}

.tagline {
  font-size: 14px;
  font-weight: 600;
  opacity: .9;
}

nav {
  display: flex;
  gap: 10px;
  padding: 14px;
  position: sticky;
  top: 0;
  background: rgba(15,37,87,.85);
  backdrop-filter: blur(20px);
  z-index: 100;
}

nav button {
  flex: 1;
  padding: 14px;
  border-radius: 14px;
  border: 2px solid rgba(255,255,255,.3);
  background: rgba(255,255,255,.15);
  backdrop-filter: blur(20px) saturate(150%);
  -webkit-backdrop-filter: blur(20px) saturate(150%);
  color: white;
  font-weight: 700;
  cursor: pointer;
  transition: all .3s ease;
  box-shadow: 
    0 4px 12px rgba(0,0,0,.25),
    inset 0 1px 0 rgba(255,255,255,.3);
}

nav button:hover {
  background: rgba(255,255,255,.22);
  transform: translateY(-2px);
  box-shadow: 
    0 6px 18px rgba(0,0,0,.3),
    inset 0 1px 0 rgba(255,255,255,.4);
}

nav button.active {
  background: rgba(255,255,255,.25);
  backdrop-filter: blur(25px) saturate(180%);
  -webkit-backdrop-filter: blur(25px) saturate(180%);
  border: 2px solid rgba(255,255,255,.5);
  box-shadow: 
    0 8px 28px rgba(139,92,246,.5),
    0 4px 12px rgba(236,72,153,.3),
    inset 0 2px 0 rgba(255,255,255,.5);
}

section {
  display: none;
  padding: 24px 16px 90px;
  max-width: 680px;
  margin: auto;
}

section.active { display: block; }

.card {
  background: linear-gradient(145deg, rgba(30,58,138,.85), rgba(15,37,87,.9));
  border-radius: 28px;
  padding: 28px;
  margin-bottom: 22px;
  border: 1.5px solid rgba(255,255,255,.25);
  box-shadow: 0 22px 55px rgba(0,0,0,.45);
  position: relative;
}

.card::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 200px;
  background: linear-gradient(135deg, rgba(139,92,246,.3), rgba(236,72,153,.25), rgba(249,115,22,.2));
  border-radius: 0 0 28px 28px;
  z-index: 0;
  pointer-events: none;
}

.card > * {
  position: relative;
  z-index: 1;
}

.card h2 {
  font-size: 26px;
  margin-bottom: 14px;
}

.card p {
  line-height: 1.6;
  opacity: .95;
}

.card ul {
  list-style: none;
}

.card ul li {
  padding: 14px 0;
  border-bottom: 1px solid rgba(255,255,255,.15);
}

.card ul li:last-child {
  border-bottom: none;
}

.reminder-card {
  background: 
    linear-gradient(145deg, rgba(139,92,246,.4), rgba(236,72,153,.35)),
    linear-gradient(to bottom right, #8B5CF6, #EC4899, #F97316);
  position: relative;
}

.reminder-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(145deg, rgba(30,58,138,.7), rgba(15,37,87,.8));
  border-radius: 28px;
  z-index: 0;
}

.reminder-card > * {
  position: relative;
  z-index: 1;
}

select {
  width: 100%;
  padding: 16px;
  border-radius: 14px;
  background: rgba(15,37,87,.9);
  border: 1.5px solid rgba(255,255,255,.3);
  color: white;
  font-weight: 600;
  margin-bottom: 14px;
  cursor: pointer;
}

select option {
  background: #0F2557;
}

input[type="text"] {
  width: 100%;
  padding: 16px;
  border-radius: 14px;
  background: rgba(15,37,87,.9);
  border: 1.5px solid rgba(255,255,255,.3);
  color: white;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 14px;
}

input[type="text"]::placeholder {
  color: rgba(255,255,255,.5);
}

button.primary {
  width: 100%;
  padding: 18px;
  border-radius: 16px;
  border: 2px solid rgba(255,255,255,.4);
  font-weight: 800;
  margin-top: 10px;
  background: rgba(255,255,255,.18);
  backdrop-filter: blur(30px) saturate(180%);
  -webkit-backdrop-filter: blur(30px) saturate(180%);
  color: white;
  cursor: pointer;
  transition: all .3s ease;
  box-shadow: 
    0 12px 32px rgba(0,0,0,.3),
    0 4px 12px rgba(139,92,246,.3),
    inset 0 2px 0 rgba(255,255,255,.5),
    inset 0 -2px 0 rgba(0,0,0,.2);
  text-shadow: 0 1px 2px rgba(0,0,0,.3);
}

button.primary:hover {
  transform: translateY(-4px);
  background: rgba(255,255,255,.25);
  border-color: rgba(255,255,255,.5);
  box-shadow: 
    0 16px 40px rgba(0,0,0,.4),
    0 6px 16px rgba(139,92,246,.4),
    inset 0 2px 0 rgba(255,255,255,.6),
    inset 0 -2px 0 rgba(0,0,0,.2);
}

button.secondary {
  background: rgba(255,255,255,.12);
  backdrop-filter: blur(25px) saturate(150%);
  -webkit-backdrop-filter: blur(25px) saturate(150%);
  border: 2px solid rgba(255,255,255,.3);
  box-shadow: 
    0 8px 24px rgba(0,0,0,.25),
    inset 0 2px 0 rgba(255,255,255,.4),
    inset 0 -2px 0 rgba(0,0,0,.15);
}

.small {
  margin-top: 14px;
  font-weight: 600;
  opacity: .9;
  text-align: center;
  font-size: 15px;
}

.personal-message {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 18px;
  color: rgba(255,255,255,.95);
}

footer {
  text-align: center;
  padding: 40px 20px;
  font-weight: 700;
  opacity: .8;
}

.modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.7);
  backdrop-filter: blur(10px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal.active {
  display: flex;
}

.modal-content {
  background: linear-gradient(145deg, rgba(30,58,138,.95), rgba(15,37,87,1));
  border-radius: 24px;
  padding: 32px;
  max-width: 400px;
  width: 100%;
  border: 2px solid rgba(255,255,255,.2);
  box-shadow: 0 30px 80px rgba(0,0,0,.6);
}

.modal-content h3 {
  font-size: 24px;
  margin-bottom: 20px;
}

/* Install prompt */
.install-prompt {
  position: fixed;
  bottom: 20px;
  left: 20px;
  right: 20px;
  background: linear-gradient(145deg, rgba(30,58,138,.95), rgba(15,37,87,1));
  border-radius: 20px;
  padding: 20px;
  border: 2px solid rgba(255,255,255,.2);
  box-shadow: 0 20px 60px rgba(0,0,0,.6);
  z-index: 999;
  display: none;
}

.install-prompt.show {
  display: block;
  animation: slideUp 0.4s ease;
}

@keyframes slideUp {
  from { transform: translateY(100px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.install-prompt h4 {
  font-size: 18px;
  margin-bottom: 10px;
}

.install-prompt p {
  font-size: 14px;
  opacity: .9;
  margin-bottom: 12px;
  line-height: 1.5;
}

.install-prompt button {
  padding: 12px 20px;
  border-radius: 12px;
  border: none;
  background: linear-gradient(135deg, rgba(139,92,246,.6), rgba(236,72,153,.5));
  color: white;
  font-weight: 700;
  cursor: pointer;
  margin-right: 10px;
}

.install-prompt .close-btn {
  background: rgba(255,255,255,.15);
  padding: 8px 16px;
  font-size: 13px;
}
</style>
</head>

<body>

<div class="ambient-bg"></div>

<div class="modal" id="nameModal">
  <div class="modal-content">
    <h3>Welcome to CalmDrive</h3>
    <label for="nameInput" style="display: block; margin-bottom: 12px; font-size: 16px; opacity: .9;">What's your name?</label>
    <input type="text" id="nameInput" name="userName" placeholder="Your name" aria-required="false">
    <button class="primary" onclick="saveName()">Let's Go</button>
  </div>
</div>

<header>
  <img src="./icon192x192.png" alt="CalmDrive Logo" class="logo">
  
  <p class="greeting">
    <span id="greetingText">Hey there</span>
    <span class="greeting-edit" onclick="editName()">change name</span>
  </p>
  
  <h1>CalmDrive</h1>
  <p class="tagline">Arrive Calm ‚Ä¢ Arrive Safe</p>
</header>

<nav>
  <button class="active" onclick="showTab('before')">Before</button>
  <button onclick="showTab('during')">During</button>
  <button onclick="showTab('log')">Log</button>
</nav>

<section id="before" class="active">
  <div class="card">
    <p class="personal-message" id="beforeMessage">Ready for a calm drive?</p>
    <h2>Pre-Drive Mindset</h2>
    <ul>
      <li>Leave early ‚Äî no rush</li>
      <li>Three slow breaths</li>
      <li>Safety over speed</li>
      <li>You're allowed to be calm</li>
    </ul>
  </div>
</section>

<section id="during">
  <div class="card reminder-card">
    <p class="personal-message" id="duringMessage">Let's stay calm together.</p>
    <h2>üéß Audio Reminders</h2>
    <label for="audioSelect" style="display: block; margin-bottom: 8px; font-size: 15px;">Choose a calming reminder:</label>
    <audio id="player" preload="metadata" aria-label="Audio reminder player"></audio>

    <select id="audioSelect" name="audioReminder" aria-label="Select audio reminder">
      <option value="">Choose a reminder</option>
      <option value="./audio/reminder1.mp3">Reminder 1</option>
      <option value="./audio/reminder2.mp3">Reminder 2</option>
      <option value="./audio/reminder3.mp3">Reminder 3</option>
      <option value="./audio/reminder4.mp3">Reminder 4</option>
      <option value="./audio/reminder5.mp3">Reminder 5</option>
      <option value="./audio/reminder6.mp3">Reminder 6</option>
    </select>

    <button class="primary" onclick="playAudio()">‚ñ∂ Play Reminder</button>
    <button class="primary secondary" onclick="stopAudio()">‚è∏ Stop</button>

    <p class="small">You're doing fine. Keep going.</p>
  </div>
</section>

<section id="log">
  <div class="card">
    <p class="personal-message" id="logMessage">How did your drive go?</p>
    <h2>Drive Log</h2>
    <p id="logText" style="font-size: 18px; margin: 16px 0;">0 calm drives logged</p>
    <button class="primary" onclick="logDrive()">‚úì Log This Drive</button>
    <p class="small">Take one calm breath. You've arrived.</p>
  </div>

  <div class="card">
    <h2>CalmDrive Plus</h2>
    <ul>
      <li>Smart reminder pacing</li>
      <li>Personalized reassurance</li>
      <li>Post-drive recovery support</li>
      <li>Drive-length awareness</li>
      <li>Automatic calm silent mode</li>
      <li>Choose male or female voice option</li>
    </ul>
    <p class="small">Coming later. Free users always welcome.</p>
  </div>
</section>

<footer>
  CalmDrive ‚Ä¢ Your Calm Matters
</footer>

<!-- Install Prompt for iOS -->
<div class="install-prompt" id="installPrompt">
  <h4>üì± Install CalmDrive</h4>
  <p>Add to your home screen for the best experience - works like a real app!</p>
  <p style="font-size: 13px; opacity: .8;">
    Tap <strong>Share ‚¨ÜÔ∏è</strong> then <strong>"Add to Home Screen"</strong>
  </p>
  <button onclick="closeInstallPrompt()">Got it</button>
  <button class="close-btn" onclick="closeInstallPrompt()">Maybe later</button>
</div>

<script>
let userName = '';
let drives = 0;

window.addEventListener('load', () => {
  userName = localStorage.getItem('calmDriveName') || '';
  drives = parseInt(localStorage.getItem('calmDrivesCount')) || 0;
  
  if (!userName) {
    document.getElementById('nameModal').classList.add('active');
  } else {
    updateGreeting();
    updateMessages();
  }
  
  document.getElementById('logText').textContent = `${drives} calm drive${drives === 1 ? '' : 's'} logged`;
});

function saveName() {
  const input = document.getElementById('nameInput').value.trim();
  if (input) {
    userName = input;
    localStorage.setItem('calmDriveName', userName);
    document.getElementById('nameModal').classList.remove('active');
    updateGreeting();
    updateMessages();
  }
}

function editName() {
  document.getElementById('nameInput').value = userName;
  document.getElementById('nameModal').classList.add('active');
}

function updateGreeting() {
  const greetings = ['Hey', 'Hi', 'Welcome back'];
  const greeting = greetings[Math.floor(Math.random() * greetings.length)];
  document.getElementById('greetingText').textContent = `${greeting}, ${userName}`;
}

function updateMessages() {
  document.getElementById('beforeMessage').textContent = `Hey ${userName}, ready for a calm drive?`;
  document.getElementById('duringMessage').textContent = `${userName}, let's stay calm together.`;
  document.getElementById('logMessage').textContent = `How did your drive go, ${userName}?`;
}

function showTab(id) {
  document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  event.target.classList.add('active');
  stopAudio();
}

function playAudio() {
  const src = document.getElementById('audioSelect').value;
  if (!src) {
    alert('Choose a reminder first');
    return;
  }
  
  const player = document.getElementById('player');
  player.src = src;
  
  player.play().catch(err => {
    console.error('Audio play error:', err);
    alert('Unable to play audio. Make sure the file exists at: ' + src);
  });
}

function stopAudio() {
  const player = document.getElementById('player');
  player.pause();
  player.currentTime = 0;
}

function logDrive() {
  drives++;
  localStorage.setItem('calmDrivesCount', drives);
  document.getElementById('logText').textContent = `${drives} calm drive${drives === 1 ? '' : 's'} logged`;
}

// Show install prompt on iOS Safari
function showInstallPrompt() {
  // Check if standalone (already installed)
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
  
  // Check if iOS Safari
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
  
  // Check if user already dismissed
  const dismissed = localStorage.getItem('installPromptDismissed');
  
  if (isIOS && !isStandalone && !dismissed) {
    setTimeout(() => {
      document.getElementById('installPrompt').classList.add('show');
    }, 3000); // Show after 3 seconds
  }
}

function closeInstallPrompt() {
  document.getElementById('installPrompt').classList.remove('show');
  localStorage.setItem('installPromptDismissed', 'true');
}

// Show install prompt on load
window.addEventListener('load', showInstallPrompt);
</script>
<script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
   navigator.serviceWorker.register('./service-worker.js')
      .then(reg => console.log('Service Worker registered:', reg.scope))
      .catch(err => console.error('Service Worker failed:', err));
  });
}
</script>

</body>
</html>
